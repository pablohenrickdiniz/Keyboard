(function(g){var n={BACK_TAB:8,TAB:9,ENTER:13,SH_TAB:16,CTRL:17,ALT_GR:18,ESC:27,SPACE:32,END:35,BEGIN:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,DEL:46,A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:87,X:88,Y:89,Z:90,PLUS:107,MINUS:109,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,LT:188,GT:190,SBR:220,SBL:221};var l={0:[48,96],1:[49,97],2:[50,98],3:[51,99],4:[52,100],5:[53,101],6:[54,102],7:[55,103],8:[56,104],9:[57,150]};function m(u){for(var t=0;t<=9;t++){if(l[t].indexOf(u)!=-1){return true}}return false}function b(v){for(var u=0;u<=9;u++){var t=l[u].indexOf(v);if(t!=-1){return u}}return null}function h(t,u){var i=u.length;for(o=0;o<i;o++){if(b(u[o])==b(t)){return true}}return false}function f(i){return i.replace(/\s/g,"").toUpperCase()}function r(t){var w=[];var u=Object.keys(n);t=t.split("+");var x=t.length;var v;for(v=0;v<x;v++){if(l[t[v]]!=undefined){w.push(l[t[v]])}else{if(u.indexOf(t[v])!=-1){w.push(n[t[v]])}}}return w}function k(x){var w=Object.keys(n);var v=w.length;var u;var t;for(u=0;u<v;u++){t=w[u];if(n[t]==x){return t}}for(u=0;u<=9;u++){if(l[u].indexOf(x)!=-1){return u+""}}return null}function q(x){var v=x.length;var u;var t=[];for(u=0;u<v;u++){var w=k(x[u]);if(w!=null){t.push(w)}}return t.join("+")}function c(v,u){var t=v.length;var i=u.length;if(t!=i){return false}for(o=0;o<t&&o<i;o++){if(((m(v[o])||m(u[o]))&&(b(v[o])!=b(u[o]))||v[o]!=u[o])){return false}}return true}function p(t,v){var u=v.length;var i=null;for(o=0;o<u;o++){i=v[o];if(t.callback==i.callback&&c(t.shortcut,i.shortcut)){return o}}return -1}function a(i){var t=null;Object.defineProperty(i,"element",{get:function(){return t},set:function(u){if(u instanceof Element&&t!=u){i.unbind();t=u;i.bind()}}});Object.defineProperty(i,"currentShortcut",{get:function(){return q(i.key_sequence)}});i.click_event=function(){i.element.focus()};i.keydown_event=function(w){var z=w.which;if(i.propagate.indexOf(z)==-1){w.preventDefault()}if(i.state[z]!=true){i.state[z]=true;var u;var v;var y=false;if(m(z)){if(!h(z,i.key_sequence)){i.key_sequence.push(z);y=true}}else{if(i.key_sequence.indexOf(z)===-1){i.key_sequence.push(z);y=true}}if(y){v=i.state_change_listeners.length;for(u=0;u<v;u++){i.state_change_listeners[u]()}}v=i.shortcut_listeners.length;for(u=0;u<v;u++){var x=i.shortcut_listeners[u];if(c(x.shortcut,i.key_sequence)){x.callback()}}}};i.keyup_event=function(x){var y=x.which;x.preventDefault();i.state[y]=false;var u=i.key_sequence.indexOf(y);if(u!==-1){i.key_sequence.splice(u,1);var w=i.state_change_listeners.length;var v;for(v=0;v<w;v++){i.state_change_listeners[v]()}}};i.blur_event=function(y){y.preventDefault();var x=Object.keys(i.state);var w=x.length;var v;var u;for(v=0;v<w;v++){u=x[v];i.state[u]=false}i.key_sequence=[];w=i.state_change_listeners.length;for(v=0;v<w;v++){i.state_change_listeners[v]()}};i.bind()}var d=function(t){var i=this;a(i);i.element=t.element||null;i.key_sequence=[];i.shortcut_listeners=[];i.state_change_listeners=[];i.state={};i.propagate=t.propagate||[]};var j=Object.keys(n);var e=j.length;var o;for(o=0;o<e;o++){var s=j[o];d[s]=n[s]}d.prototype.addShortcutListener=function(v,w){var t=this;v=f(v);var i=r(v);var u={shortcut:i,callback:w};if(p(u,t.shortcut_listeners)==-1){t.shortcut_listeners.push(u)}else{console.error("This callback is already registered with shortcut '"+v+"'")}};d.prototype.removeShortcutListener=function(i,w){var t=this;var v={shortcut:i,callback:w};var u=p(v,t.shortcut_listeners);if(u!=-1){t.shortcut_listeners.splice(u,1)}};d.prototype.addStateChangeListener=function(t){var i=this;if(i.state_change_listeners.indexOf(t)==-1){i.state_change_listeners.push(t)}};d.prototype.removeStateChangeListener=function(u){var i=this;var t=i.state_change_listeners.indexOf(u);if(t!=-1){i.state_change_listeners.splice(t,1)}};d.prototype.unbind=function(){var i=this;var t=i.element;if(t!=null){t.removeEventListener("click",i.click_event);t.removeEventListener("keydown",i.keydown_event);t.removeEventListener("keyup",i.keyup_event);t.removeEventListener("blur",i.blur_event)}g.removeEventListener("blur",i.blur_event)};d.prototype.bind=function(){var i=this;i.unbind();var t=i.element;if(t!=null){t.setAttribute("tabindex",1);t.addEventListener("click",i.click_event);t.addEventListener("keydown",i.keydown_event);t.addEventListener("keyup",i.keyup_event);t.addEventListener("blur",i.blur_event)}g.addEventListener("blur",i.blur_event)};g.Keyboard=d})(window);