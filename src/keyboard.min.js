"use strict";(function(j){let letter_codes={BACK_TAB:8,TAB:9,ENTER:13,SH_TAB:16,CTRL:17,ALT_GR:18,ESC:27,SPACE:32,END:35,BEGIN:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,DEL:46,A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:87,X:88,Y:89,Z:90,PLUS:107,MINUS:109,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,LT:188,GT:190,SBR:220,SBL:221};let numeric_codes={0:[48,96],1:[49,97],2:[50,98],3:[51,99],4:[52,100],5:[53,101],6:[54,102],7:[55,103],8:[56,104],9:[57,150]};function k(m){for(let i=0;i<=9;i++){if(numeric_codes[i].indexOf(m)!==-1){return true}}return false}function f(m){for(let i=0;i<=9;i++){let index=numeric_codes[i].indexOf(m);if(index!==-1){return i}}return null}function c(m,n){let length=n.length;for(i=0;i<length;i++){if(f(n[i])===f(m)){return true}}return false}function e(m){return m.replace(/\s/g,"").toUpperCase()}function g(m){let keySequence=[];let letter_keys=Object.keys(letter_codes);m=m.split("+");let length=m.length;let i;for(i=0;i<length;i++){if(numeric_codes[m[i]]!==undefined){keySequence.push(numeric_codes[m[i]])}else{if(letter_keys.indexOf(m[i])!==-1){keySequence.push(letter_codes[m[i]])}}}return keySequence}function l(m){let keys=Object.keys(letter_codes);let length=keys.length;let i;let key;for(i=0;i<length;i++){key=keys[i];if(letter_codes[key]===m){return key}}for(i=0;i<=9;i++){if(numeric_codes[i].indexOf(m)!==-1){return i+""}}return null}function b(m){let lengthB=m.length;let i;let shortcut=[];for(i=0;i<lengthB;i++){let keyName=l(m[i]);if(keyName!=null){shortcut.push(keyName)}}return shortcut.join("+")}function a(n,m){let lengthA=n.length;let lengthB=m.length;if(lengthA!==lengthB){return false}for(i=0;i<lengthA&&i<lengthB;i++){if(((k(n[i])||k(m[i]))&&(f(n[i])!==f(m[i]))||n[i]!==m[i])){return false}}return true}function h(m,n){let length=n.length;let scb=null;for(i=0;i<length;i++){scb=n[i];if(m.callback===scb.callback&&a(m.shortcut,scb.shortcut)){return i}}return -1}function d(m){let element=null;Object.defineProperty(m,"element",{get:function(){return element},set:function(n){if(n instanceof Element&&element!==n){m.unbind();element=n;m.bind()}}});Object.defineProperty(m,"currentShortcut",{get:function(){return b(m.key_sequence)}});m.click_event=function(){m.element.focus()};m.keydown_event=function(n){let which=n.which;if(m.propagate.indexOf(which)===-1){n.preventDefault()}if(m.state[which]!==true){m.state[which]=true;let i;let length;let changed=false;if(k(which)){if(!c(which,m.key_sequence)){m.key_sequence.push(which);changed=true}}else{if(m.key_sequence.indexOf(which)===-1){m.key_sequence.push(which);changed=true}}if(changed){length=m.state_change_listeners.length;for(i=0;i<length;i++){m.state_change_listeners[i]()}}length=m.shortcut_listeners.length;for(i=0;i<length;i++){let shortcut_callback=m.shortcut_listeners[i];if(a(shortcut_callback.shortcut,m.key_sequence)){shortcut_callback.callback()}}}};m.keyup_event=function(n){let which=n.which;n.preventDefault();m.state[which]=false;let index=m.key_sequence.indexOf(which);if(index!==-1){m.key_sequence.splice(index,1);let length=m.state_change_listeners.length;let i;for(i=0;i<length;i++){m.state_change_listeners[i]()}}};m.blur_event=function(n){n.preventDefault();let keys=Object.keys(m.state);let length=keys.length;let i;let key;for(i=0;i<length;i++){key=keys[i];m.state[key]=false}m.key_sequence=[];length=m.state_change_listeners.length;for(i=0;i<length;i++){m.state_change_listeners[i]()}};m.bind()}let Keyboard=function(m){let self=this;d(self);self.element=m.element||null;self.key_sequence=[];self.shortcut_listeners=[];self.state_change_listeners=[];self.state={};self.propagate=m.propagate||[]};let keys=Object.keys(letter_codes);let length=keys.length;let i;for(i=0;i<length;i++){let key=keys[i];Keyboard[key]=letter_codes[key]}Keyboard.prototype.addShortcutListener=function(m,n){let self=this;m=e(m);let shortcut=g(m);let sc={shortcut:shortcut,callback:n};if(h(sc,self.shortcut_listeners)===-1){self.shortcut_listeners.push(sc)}else{console.error("This callback is already registered with shortcut '"+m+"'")}};Keyboard.prototype.removeShortcutListener=function(m,n){let self=this;let sc={shortcut:m,callback:n};let index=h(sc,self.shortcut_listeners);if(index!==-1){self.shortcut_listeners.splice(index,1)}};Keyboard.prototype.addStateChangeListener=function(m){let self=this;if(self.state_change_listeners.indexOf(m)===-1){self.state_change_listeners.push(m)}};Keyboard.prototype.removeStateChangeListener=function(m){let self=this;let index=self.state_change_listeners.indexOf(m);if(index!==-1){self.state_change_listeners.splice(index,1)}};Keyboard.prototype.unbind=function(){let self=this;let element=self.element;if(element!=null){element.removeEventListener("click",self.click_event);element.removeEventListener("keydown",self.keydown_event);element.removeEventListener("keyup",self.keyup_event);element.removeEventListener("blur",self.blur_event)}j.removeEventListener("blur",self.blur_event)};Keyboard.prototype.bind=function(){let self=this;self.unbind();let element=self.element;if(element!=null){element.setAttribute("tabindex",1);element.addEventListener("click",self.click_event);element.addEventListener("keydown",self.keydown_event);element.addEventListener("keyup",self.keyup_event);element.addEventListener("blur",self.blur_event)}j.addEventListener("blur",self.blur_event)};j.Keyboard=Keyboard})(window);